<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Xadrez</title>
    <link rel="stylesheet" href="css/quiz.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<header>
    <img class="logo" src="assets/imgs/logo_cavalo-Photoroom.png" alt="Logo - Imagem de um cavalo" width="150px">
    <nav class="navbar"> 
        <ul class="nav-links">
            <li><a href="informacoes.html#sessao-variantes">Variantes</a> </li>
            <li> <a href="informacoes.html#links-uteis">Links √öteis</a></li>
        </ul>
    </nav>
    <div class="buttons">
        <a href="index.html" class="sair">Sair</a>
        <a href="informacoes.html" class="voltar">Voltar</a>
    </div>
    
</header>
<body>
    <div class="container">
        <div id="selecaoNivel" class="tela-selecao">
            <h2>Escolha o n√≠vel do quiz:</h2>
            <div class="botoes-nivel">
                <button onclick="selecionarNivel('Iniciante')">Iniciante</button>
                <button onclick="selecionarNivel('Intermediario')">Intermedi√°rio</button>
                <button onclick="selecionarNivel('Avancado')">Avan√ßado</button>
            </div>
        </div>
        <div id="quizContainer" class="hidden">
            <div id="pontuacao" class="pontuacao-container">
                <div id="pontuacaoDuranteJogo">
                    <span>Acertos: <span id="spanCertas"></span></span>
                    <span>Erros: <span id="spanErradas"></span></span>
                </div>
            </div>

            <div id="jogo" class="quiz-container">
                <div id="infoQuestao">
                    <span>Quest√£o <span id="spanNumeroDaQuestaoAtual"></span> de <span id="qtdQuestoes"></span></span>
                </div>

                <div id="perguntaDaQuestaoAtual">
                    <span id="spanQuestaoExibida"></span>
                </div>

                <div id="opcoes" class="opcoes-container">
                    <label class="opcao">
                        <input type="radio" name="option" value="alternativaA">
                        <span id="labelOpcaoUm"></span>
                    </label>
                    <label class="opcao">
                        <input type="radio" name="option" value="alternativaB">
                        <span id="labelOpcaoDois"></span>
                    </label>
                    <label class="opcao">
                        <input type="radio" name="option" value="alternativaC">
                        <span id="labelOpcaoTres"></span>
                    </label>
                    <label class="opcao">
                        <input type="radio" name="option" value="alternativaD">
                        <span id="labelOpcaoQuatro"></span>
                    </label>
                </div>

                <div class="botoes-container">
                    <button onclick="responder()" id="btnResponder">Responder</button>
                    <button onclick="proximo()" id="btnProx">Pr√≥xima</button>
                    <button onclick="reiniciarQuiz()" id="btnReiniciar">Reiniciar</button>
                </div>
            </div>
        </div>
        <div id="resultadoFinal" class="hidden">
            <div class="resultado-container">
                <div class="resultado-texto">
                    <p>Acertos: <span id="finalCertas"></span></p>
                    <p>Erros: <span id="finalErradas"></span></p>
                    <p>Total de quest√µes: <span id="finalTotal"></span></p>
                </div>
                
                <div class="grafico-kpi-container">

                    <div class="grafico-container">
                        <canvas id="graficoResultado"></canvas>
                    </div>

                    <div class="kpi-container">
                        <div class="kpi-cartao">
                            <h3>M√©dia de Acertos</h3>
                            <div class="kpi-valor" id="kpiMediaAcertos"></div>
                            <div class="kpi-comparacao">
                                <span id="kpiComparacao"></span>
                            </div>
                        </div>
                        
                        <div class="kpi-cartao">
                            <h3>Total de Jogadores</h3>
                            <div class="kpi-valor" id="kpiTotalUsuarios"></div>
                            <div class="kpi-descricao" id="kpiDescricao">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button onclick="reiniciarQuiz()">Fazer outro quiz</button>
        </div>
    </div>

</body>

</html>

<script>

const listaDeQuestoes = {
    Iniciante: [
        {
            pergunta: "Qual o movimento/dire√ß√£o em que o cavalo se movimenta?",
            alternativaA: "Horizontal.",
            alternativaB: "Vertical.",
            alternativaC: "Em 'L'.",
            alternativaD: "Diagonal.",
            alternativaCorreta: "alternativaC"
        },
        {
            pergunta: "Qual o objetivo do Xadrez ?",
            alternativaA: "Comer todas as pe√ßas do oponente.",
            alternativaB: "Comer a pe√ßa Rainha.",
            alternativaC: "Deixar o oponente sem jogada.",
            alternativaD: "Dar um xeque e deixar o oponente sem jogada. Xeque-mate.",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "Qual a pe√ßa mais forte do jogo ?",
            alternativaA: "Cavalo.",
            alternativaB: "Pe√£o.",
            alternativaC: "Rainha.",
            alternativaD: "Rei.",
            alternativaCorreta: "alternativaC"
        },
        {
            pergunta: "Qual a pe√ßa mais importante do jogo ?",
            alternativaA: "Cavalo.",
            alternativaB: "Pe√£o.",
            alternativaC: "Rainha",
            alternativaD: "Rei",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "O que significa a jogada 'Un-passant'?",
            alternativaA: "Quando o jogador fica sem jogada.",
            alternativaB: "Caso um pe√£o ande duas casas no come√ßo do jogo e passe por uma casa atacada por outro pe√£o esse pe√£o pode capturar o outro.",
            alternativaC: "Quando a pessoa come a Rainha.",
            alternativaD: "Quando o pe√£o promove para alguma pe√ßa.",
            alternativaCorreta: "alternativaB"   
        }
    ],
    Intermediario:[
    {
            pergunta: "O que acontece quando um pe√£o chega ao final do tabuleiro? Na √∫ltima casa?",
            alternativaA: "Nada.",
            alternativaB: "Ele pode virar qualquer pe√ßa que quiser.",
            alternativaC: "Depende, se for um pe√£o que n√£o seja da coluna da torre, pode virar qualquer pe√ßa.",
            alternativaD: "O jogador ganha o jogo.",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "O que √© uma 'cravada' no xadrez?",
            alternativaA: "Quando um pe√£o avan√ßa duas casas no primeiro movimento.",
            alternativaB: "Quando uma pe√ßa n√£o pode se mover sem expor o rei ao ataque.",
            alternativaC: "Quando o rei est√° em xeque e n√£o pode escapar.",
            alternativaD: "Quando duas torres s√£o colocadas na mesma coluna.",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "Como sair de um xeque-duplo?",
            alternativaA: "N√£o tem sa√≠da √© um xeque-mate.",
            alternativaB: "comer uma das pe√ßas que est√° atacando.",
            alternativaC: "Mover o rei.",
            alternativaD: "Dando outro xeque.",
            alternativaCorreta: "alternativaC"
        },
        {
            pergunta: "O que acontece em um jogo caso haja um repeti√ß√£o tripla ?",
            alternativaA: "Nada.",
            alternativaB: "O jogador que come√ßou com a repeti√ß√£o pode declarar vit√≥ria.",
            alternativaC: "O jogador que n√£o come√ßou com a repeti√ß√£o pode declarar vit√≥ria.",
            alternativaD: "Qualquer um dos jogadores pode declarar empate.",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "O que √© um 'cavalo ativo' e por que ele √© valioso?",
            alternativaA: "Um cavalo que ataca pe√µes indefesos.",
            alternativaB: "Um cavalo posicionado em uma casa central avan√ßada, sem poder ser expulso por pe√µes.",
            alternativaC: "Um cavalo que protege o rei no roque.",
            alternativaD: "Um cavalo que pode ser trocado por um bispo.",
            alternativaCorreta: "alternativaB"
        }
    ],
    Avancado: [
    {
            pergunta: "Em um final de torres com pe√µes passados em lados opostos, qual princ√≠pio geral √© mais importante?",
            alternativaA: "Manter a torre atr√°s do pe√£o passado, seja pr√≥prio ou advers√°rio.",
            alternativaB: "Trocar torres o mais r√°pido poss√≠vel para chegar a um final de pe√µes.",
            alternativaC: "Usar o rei para bloquear o pe√£o passado advers√°rio.",
            alternativaD: "Avan√ßar o pe√£o passado imediatamente, mesmo sem apoio do rei.",
            alternativaCorreta: "alternativaA"
        },
        {
            pergunta: "Qual √© a melhor maneira de explorar um 'pe√£o fraco' (isolado, atrasado ou dobrado) na posi√ß√£o advers√°ria?",
            alternativaA: "Trocar todas as pe√ßas para chegar a um final favor√°vel.",
            alternativaB: "Colocar pe√ßas em casas que pressionem o pe√£o fraco e limitem a mobilidade inimiga.",
            alternativaC: "Ignorar o pe√£o fraco e atacar o rei advers√°rio.",
            alternativaD: "Oferecer um sacrif√≠cio para distrair o oponente.",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "Qual √© o final mais dif√≠cil considerado no xadrez ?",
            alternativaA: "Rei, pe√£o e torre contra rei.",
            alternativaB: "Rei, cavalo e bispo contra rei.",
            alternativaC: "Rei e dama contra rei.",
            alternativaD: "Rei e pe√£o contra rei.",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "Em um final de bispos de cores opostas, por que posi√ß√µes com pe√µes fixados na mesma cor do bispo s√£o mais f√°ceis de defender ?",
            alternativaA: "Porque o bispo n√£o pode atacar pe√µes em casas de cor diferente.",
            alternativaB: "Porque o rei pode bloquear os pe√µes sem risco de penetra√ß√£o.",
            alternativaC: "Porque o bispo defensor pode ficar em uma diagonal longa, protegendo m√∫ltiplas fraquezas.",
            alternativaD: "Porque o empate √© inevit√°vel, mesmo com vantagem material.",
            alternativaCorreta: "alternativaA"
        },
        {
            pergunta: "Em um final de dama + pe√£o vs. dama, quando o pe√£o est√° na 7¬™ casa (pr√≥ximo de promover), qual fator √© decisivo para determinar se a defesa pode for√ßar o empate?",
            alternativaA: "Se a dama atacante pode cobrir a casa de promo√ß√£o com cheque.",
            alternativaB: "A capacidade da dama defensora de aplicar 'cheques perp√©tuos'.",
            alternativaC: "Se o rei atacante est√° protegendo seu pe√£o contra capturas.",
            alternativaD: "A dist√¢ncia do rei defensor em rela√ß√£o ao pe√£o.",
            alternativaCorreta: "alternativaD"
        }
    ]
};


let nivelSelecionado = '';
let questoesDoNivel = [];
let numeroDaQuestaoAtual = 0;
let certas = 0;
let erradas = 0;
let quantidadeDeQuestoes = 0;
let respostaSelecionada = null;
let grafico = null;
let questaoRespondida = false;


function selecionarNivel(nivel) {
    nivelSelecionado = nivel;
    questoesDoNivel = listaDeQuestoes[nivel];
    quantidadeDeQuestoes = questoesDoNivel.length;
    
    document.getElementById('selecaoNivel').classList.add('hidden');
    document.getElementById('quizContainer').classList.remove('hidden');
    
    iniciarQuiz();
}


function iniciarQuiz() {
    
    numeroDaQuestaoAtual = 0;
    certas = 0;
    erradas = 0;
    questaoRespondida = false;
    
    // Atualiza as certas erradas e quantas tem
    document.getElementById('spanCertas').innerHTML = certas;
    document.getElementById('spanErradas').innerHTML = erradas;
    document.getElementById('qtdQuestoes').innerHTML = quantidadeDeQuestoes;
    
    
    mostrarQuestaoAtual();
}


function mostrarQuestaoAtual() {
    const questaoAtual = questoesDoNivel[numeroDaQuestaoAtual];
    questaoRespondida = false;
    
    // Atualiza a quest√£o que est√° sendo exibida
    document.getElementById('spanNumeroDaQuestaoAtual').innerHTML = numeroDaQuestaoAtual + 1;
    document.getElementById('spanQuestaoExibida').innerHTML = questaoAtual.pergunta;
    document.getElementById('labelOpcaoUm').innerHTML = questaoAtual.alternativaA;
    document.getElementById('labelOpcaoDois').innerHTML = questaoAtual.alternativaB;
    document.getElementById('labelOpcaoTres').innerHTML = questaoAtual.alternativaC;
    document.getElementById('labelOpcaoQuatro').innerHTML = questaoAtual.alternativaD;
   
    // Reseta a sele√ß√£o
    document.getElementsByName("option").forEach(radio => {
        radio.checked = false;
        radio.parentElement.classList.remove('resposta-correta', 'resposta-incorreta');
    });
    
    document.getElementById('btnProx').classList.add('hidden');

   
}


function responder() {
    const opcoes = document.getElementsByName("option");
    const questaoAtual = questoesDoNivel[numeroDaQuestaoAtual];
    respostaSelecionada = null;

    document.getElementById('btnProx').classList.remove('hidden');
    if (questaoRespondida) {
        alert('Voc√™ j√° respondeu esta quest√£o!');
        return;
    }
    
    opcoes.forEach(opcao => {
        if (opcao.checked) {
            respostaSelecionada = opcao.value;
        }
    });

    if (!respostaSelecionada) {
        alert('Por favor, selecione uma resposta!');
        return;
    }
    
    // Verifica qual op√ß√£o foi selecionada
    opcoes.forEach(opcao => {
        if (opcao.checked) {
            respostaSelecionada = opcao.value;
            opcao.parentElement.classList.add(
                opcao.value === questaoAtual.alternativaCorreta 
                    ? 'resposta-correta' 
                    : 'resposta-incorreta'
            );
        }
        
        // Marca a resposta correta
        if (opcao.value === questaoAtual.alternativaCorreta) {
            opcao.parentElement.classList.add('resposta-correta');
        }
    });

    
    // Atualiza as respostas certas e erradas
    if (respostaSelecionada === questaoAtual.alternativaCorreta) {
        certas++;
    } else {
        erradas++;
    }
    
    document.getElementById('spanCertas').innerHTML = certas;
    document.getElementById('spanErradas').innerHTML = erradas;
    questaoRespondida = true;
}

function proximo() {
    if (!questaoRespondida) {
        alert('Por favor, responda a quest√£o antes de avan√ßar!');
        return;
    }
    numeroDaQuestaoAtual++;
    
    if (numeroDaQuestaoAtual < quantidadeDeQuestoes) {
        mostrarQuestaoAtual();
    } else {
        mostrarResultadoFinal();
    }
}

function mostrarResultadoFinal() {
    document.getElementById('quizContainer').classList.add('hidden');
    document.getElementById('resultadoFinal').classList.remove('hidden');
    

    document.getElementById('finalCertas').innerHTML = certas;
    document.getElementById('finalErradas').innerHTML = erradas;
    document.getElementById('finalTotal').innerHTML = quantidadeDeQuestoes;
    
    //Salvar o resultado no banco
    const idUsuario = sessionStorage.getItem('ID_USUARIO');
    const fkQuiz = 1;
    if (idUsuario) {
        fetch("/quiz/salvarResultado", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkUsuario: idUsuario,
                nivel: nivelSelecionado,
                acertos: certas,
                fkQuiz: 1
            })
        })
        .then(resposta => resposta.json())
        .then(dados => {
            console.log("Resultado salvo:", dados.message);
            // Buscar estat√≠sticas e criar gr√°fico ap√≥s salvar
            buscarEstatisticasECriarGrafico();
        })
        .catch(erro => {
            console.error("Erro ao salvar resultado:", erro);
            criarGraficoResultado();
        });
    } else {
        console.warn("Usu√°rio n√£o logado. Resultado n√£o ser√° salvo.");
}
}


function buscarEstatisticasECriarGrafico() {
    fetch(`/quiz/estatisticas?nivel=${nivelSelecionado}`)
    .then(resposta => {
        if (!resposta.ok) {
            console.erro(`Erro HTTP: ${resposta.status}`);
        }
        return resposta.json();
    })
    .then(dadosEstatisticas => {
        // Preencher KPIs
        document.getElementById('kpiMediaAcertos').innerHTML = parseFloat(dadosEstatisticas.media_acertos).toFixed(1);
        
        document.getElementById('kpiTotalUsuarios').innerHTML = dadosEstatisticas.total_usuarios;
        
        document.getElementById('kpiDescricao').innerHTML = `Neste n√≠vel ${nivelSelecionado}`;
        
        // Adicionar compara√ß√£o de desempenho
        const media = parseFloat(dadosEstatisticas.media_acertos);
        const mensagem_KPI_acertos = document.getElementById('kpiComparacao');

        
        if (certas > media) {
            mensagem_KPI_acertos.innerHTML = `üòÑüëå Parab√©ns ${sessionStorage.getItem('NOME_USUARIO')}, <strong>Acima</strong> da m√©dia em (+${(certas - media).toFixed(1)})`;
        } else if (certas < media) {
            mensagem_KPI_acertos.innerHTML = `üòê Que pena ${sessionStorage.getItem('NOME_USUARIO')}, <strong>Abaixo</strong> da m√©dia em (${(certas - media).toFixed(1)})`;
        } else {
            mensagem_KPI_acertos.innerHTML = `üÜó Ainda pode melhorar ${sessionStorage.getItem('NOME_USUARIO')}, na m√©dia exata`;
        };
        

        criarGraficoResultado(dadosEstatisticas);
    })
    .catch(erro => {
        console.error("Erro ao buscar estat√≠sticas:", erro);
        
        document.getElementById('kpiMediaAcertos').innerHTML = '0.0';
        document.getElementById('kpiTotalUsuarios').innerHTML = '0';
        document.getElementById('kpiComparacao').innerHTML = 'Dados indispon√≠veis';
    });
}


function criarGraficoResultado(dadosEstatisticas) {
    const ctx = document.getElementById('graficoResultado').getContext('2d');
    

    if (grafico) {
        grafico.destroy();
    }
    
    grafico = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Acertos', 'Erros', 'Total'],
            datasets: [{
                data: [certas, erradas, quantidadeDeQuestoes],
                backgroundColor: [
                    'rgba(25, 135, 84, 0.7)',  
                    'rgba(220, 53, 69, 0.7)',  
                    'rgba(108, 117, 125, 0.7)' 
                ],
                borderColor: [
                    'rgba(25, 135, 84, 1)',
                    'rgba(220, 53, 69, 1)',
                    'rgba(108, 117, 125, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {  
                    ticks: {
                        font: {
                            size: 22
                        }
                    }
                },
                y: {
                    beginAtZero: true,
                    max: quantidadeDeQuestoes,
                    ticks: {
                        stepSize: 1,
                        font: {
                            size: 22   
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: `Desempenho no N√≠vel ${nivelSelecionado}`,
                    font: {
                        size: 25
                    }
            }}
        }
    });
}


function reiniciarQuiz() {
    document.getElementById('quizContainer').classList.add('hidden');
    document.getElementById('selecaoNivel').classList.remove('hidden');
    document.getElementById('resultadoFinal').classList.add('hidden');

    if (grafico) {
        grafico.destroy();
        grafico = null;
    }
}
</script>











